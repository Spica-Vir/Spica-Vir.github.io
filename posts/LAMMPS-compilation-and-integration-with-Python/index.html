<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="LAMMPS compilation and integration with Python" /><meta property="og:locale" content="en" /><meta name="description" content="Procedures to Compile LAMMPS as both static and dynamic libs are summarized in this post. When compiled as the dynamic lib, the integration of LAMMPS and python environment is briefly explored. The compiled version of LAMMPS is 23Jun2022, with OpenMP threading, GPU acceleration and FFT by FFTW3. Tested on NHPC101 (OpenSUSE Leap 15.3), from Dec. 28 to Dec. 30 2022." /><meta property="og:description" content="Procedures to Compile LAMMPS as both static and dynamic libs are summarized in this post. When compiled as the dynamic lib, the integration of LAMMPS and python environment is briefly explored. The compiled version of LAMMPS is 23Jun2022, with OpenMP threading, GPU acceleration and FFT by FFTW3. Tested on NHPC101 (OpenSUSE Leap 15.3), from Dec. 28 to Dec. 30 2022." /><link rel="canonical" href="https://spica-vir.github.io/posts/LAMMPS-compilation-and-integration-with-Python/" /><meta property="og:url" content="https://spica-vir.github.io/posts/LAMMPS-compilation-and-integration-with-Python/" /><meta property="og:site_name" content="Spica. Vir" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-12-30T15:32:20+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="LAMMPS compilation and integration with Python" /><meta name="twitter:site" content="@twitter_username" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-04-20T21:53:38+01:00","datePublished":"2022-12-30T15:32:20+00:00","description":"Procedures to Compile LAMMPS as both static and dynamic libs are summarized in this post. When compiled as the dynamic lib, the integration of LAMMPS and python environment is briefly explored. The compiled version of LAMMPS is 23Jun2022, with OpenMP threading, GPU acceleration and FFT by FFTW3. Tested on NHPC101 (OpenSUSE Leap 15.3), from Dec. 28 to Dec. 30 2022.","headline":"LAMMPS compilation and integration with Python","mainEntityOfPage":{"@type":"WebPage","@id":"https://spica-vir.github.io/posts/LAMMPS-compilation-and-integration-with-Python/"},"url":"https://spica-vir.github.io/posts/LAMMPS-compilation-and-integration-with-Python/"}</script><title>LAMMPS compilation and integration with Python | Spica. Vir</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Spica. Vir"><meta name="application-name" content="Spica. Vir"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://cdn.jsdelivr.net/gh/spica-vir/spica-vir.github.io/images//avatar.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Spica. Vir</a></div><div class="site-subtitle font-italic">Research, techniques and interests</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/Spica-Vir" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="" aria-label="" target="_blank" rel="noopener"> <i class=""></i> </a> <a href=" javascript:location.href = 'mailto:' + ['spica.h.zhou','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="" aria-label="" target="_blank" rel="noopener"> <i class=""></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>LAMMPS compilation and integration with Python</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>LAMMPS compilation and integration with Python</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/Spica-Vir">Spica.Vir</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" date="2022-12-30 15:32:20 +0000" data-toggle="tooltip" data-placement="bottom" title="Fri, Dec 30, 2022, 3:32 PM +0000" >Dec 30, 2022</em> </span> <span> Updated <em class="timeago" date="2024-04-20 21:53:38 +0100 " data-toggle="tooltip" data-placement="bottom" title="Sat, Apr 20, 2024, 9:53 PM +0100" >Apr 20</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1268 words"> <em>7 min</em> read</span></div></div></div><div class="post-content"><p>Procedures to Compile <a href="https://www.lammps.org/#gsc.tab=0">LAMMPS</a> as both static and dynamic libs are summarized in this post. When compiled as the dynamic lib, the integration of LAMMPS and python environment is briefly explored. The compiled version of LAMMPS is 23Jun2022, with OpenMP threading, GPU acceleration and FFT by FFTW3. Tested on NHPC101 (OpenSUSE Leap 15.3), from Dec. 28 to Dec. 30 2022.</p><h1 id="prerequisites">Prerequisites</h1><p>Environment establishment:</p><ul><li>cmake 3.23.1<li>fftw 3.3.10<li>Intel OneAPI 2022.1.2.146<li>NvidiaHPC-SDK 22.3 (CUDA 11.6)</ul><p>Basic information about NHPC101:</p><ul><li>CPU: Intel core i7-7700<li>GPU: Nvidia Quadro P400</ul><h2 id="cmake">cmake<a href="#cmake" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>The compilation of <a href="https://cmake.org/">cmake</a> is rather clear, which is also given in <a href="https://docs.lammps.org/Build_cmake.html#installing-cmake">LAMMPS manual</a>. All the compilations are based on cmake.</p><h2 id="fftw3">FFTW3<a href="#fftw3" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p><strong>Trivial molecular dynamics calculations by LAMMPS does not require FFT</strong>. The <a href="https://docs.lammps.org/Packages_details.html#pkg-kspace">KSPACE package</a>, and probably other packages involving reciprocal space, requires FFT to solve long-range interactions. It is also pointed out in the document that, without FFTW3, LAMMPS can also build FFT libs by the built-in KISS package. FFTW3 can probably improve the performance but for sure brings more troubles in compilation. See <a href="https://docs.lammps.org/Build_settings.html#fft-library">this page</a>.</p><p>The compilation procedures of FFTW3 libs are given in <a href="https://spica-vir.github.io/posts/Optimized-Compilation-of-FFTW3/">Optimized Compilation of FFTW3</a>. The built-in FFTW wrapper of Intel OneAPI is not sufficient to meet the needs. As suggested in the <a href="https://docs.lammps.org/Build_settings.html#fft-library">manual</a>, a single-precision FFTW3 lib is used.</p><h2 id="intel-suite">Intel Suite<a href="#intel-suite" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>For Intel CPUs, the Intel suite are helpful to get the optimal accelerations especially when combined with the <a href="https://docs.lammps.org/Build_extras.html#intel">INTEL package</a>. This package also offers moderate acceleration when the code is compiled with other compilers. It should be noted that the current implementation of LAMMPS supports classic C/C++ compilers only, i.e., <code class="language-plaintext highlighter-rouge">CC=icc</code> and <code class="language-plaintext highlighter-rouge">CXX=icpc</code>. The DPC++/C++ compiler (<code class="language-plaintext highlighter-rouge">icx</code>) leads to errors.</p><h2 id="gpu-acceleration">GPU acceleration<a href="#gpu-acceleration" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>Nvidia compilers are not required, so the NvidiaHPC-SDK suite is not necessarily needed, but CUDA is required. The <a href="https://docs.lammps.org/Build_extras.html#gpu-package">GPU package</a> is a relatively independent one, which can be skipped without interfering the integrity of the code. To include GPU acceleration, the following paths must be added before compilation if the CUDA is not loaded individually by environment modulus, and it should be noted that NvidiaHPC-SDK suite should not be loaded as a whole since the Intel suite is needed:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="s2">"</span><span class="nv">$PATH</span><span class="s2">:/path/to/NvidiaHPC-SDK/22.3/cuda/11.6/bin"</span>
<span class="gp">$</span><span class="w"> </span><span class="nb">export </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">LD_LIBRARY_PATH</span><span class="k">}</span><span class="s2">:/path/to/NvidiaHPC-SDK/22.3/cuda/11.6/lib64"</span>
<span class="gp">$</span><span class="w"> </span><span class="nb">export </span><span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="s2">"</span><span class="k">${</span><span class="nv">LD_LIBRARY_PATH</span><span class="k">}</span><span class="s2">:/path/to/NvidiaHPC-SDK/22.3/cuda/11.6/extras/CUPTI/lib64"</span>
</pre></table></code></div></div><h1 id="compilation">Compilation</h1><p>LAMMPS can be compiled either statically or dynamically. Both can produce executable. The previous option is similar to the traditional computational codes, which executes jobs and give results as a blackbox and can be called by an external application. The latter one can be loaded as a dynamic lib (which is much easier than being loaded as a static lib) and enables interactive developing, such as being integrated with atomic simulation environment (ASE). But dynamic linking requires more settings as the compilation does not really link the required libs but records their paths only.</p><h2 id="static-build">Static build<a href="#static-build" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>The following options enable a static linking:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span>cmake ../cmake <span class="nt">--install-prefix</span> /path/to/lammps/23Jun2022/ <span class="nt">-D</span> <span class="nv">LAMMPS_MACHINE</span><span class="o">=</span>stc <span class="nt">-D</span> <span class="nv">CMAKE_CXX_COMPILER</span><span class="o">=</span>icpc <span class="nt">-D</span> <span class="nv">PKG_INTEL</span><span class="o">=</span>ON <span class="nt">-D</span> <span class="nv">INTEL_ARCH</span><span class="o">=</span>cpu <span class="nt">-D</span> <span class="nv">PKG_KSPACE</span><span class="o">=</span>ON <span class="nt">-D</span> <span class="nv">PKG_MOLECULE</span><span class="o">=</span>ON <span class="nt">-D</span> <span class="nv">PKG_EXTRA_MOLECULE</span><span class="o">=</span>ON <span class="nt">-D</span> <span class="nv">PKG_EXTRA_PAIR</span><span class="o">=</span>ON <span class="nt">-D</span> <span class="nv">PKG_PHONON</span><span class="o">=</span>ON <span class="nt">-D</span> <span class="nv">PKG_MANYBODY</span><span class="o">=</span>ON <span class="nt">-D</span> <span class="nv">BUILD_OMP</span><span class="o">=</span><span class="nb">yes</span> <span class="nt">-D</span> <span class="nv">PKG_OPENMP</span><span class="o">=</span>ON <span class="nt">-D</span> <span class="nv">CMAKE_CXX_FLAGS</span><span class="o">=</span><span class="nt">-fopenmp</span> <span class="nt">-D</span> <span class="nv">CMAKE_EXE_LINKER_FLAGS</span><span class="o">=</span><span class="nt">-fopenmp</span> <span class="nt">-D</span> <span class="nv">PKG_GPU</span><span class="o">=</span>ON <span class="nt">-D</span> <span class="nv">GPU_API</span><span class="o">=</span>cuda <span class="nt">-D</span> <span class="nv">GPU_PREC</span><span class="o">=</span>double <span class="nt">-D</span> <span class="nv">GPU_ARCH</span><span class="o">=</span>sm_60 <span class="nt">-D</span> <span class="nv">FFT</span><span class="o">=</span>FFTW3 <span class="nt">-D</span> <span class="nv">FFT_SINGLE</span><span class="o">=</span>YES <span class="nt">-D</span> <span class="nv">FFTW3F_LIBRARY</span><span class="o">=</span>/path/to/fftw/3.3.10/lib64/libfftw3f.a <span class="nt">-D</span> <span class="nv">FFTW3F_OMP_LIBRARY</span><span class="o">=</span>/path/to/fftw/3.3.10/lib64/libfftw3f_omp.a
<span class="gp">$</span><span class="w"> </span>cmake <span class="nt">--build</span> <span class="nb">.</span>
<span class="gp">$</span><span class="w"> </span>make <span class="nb">install</span>
</pre></table></code></div></div><p>Packages are loaded according to needs. Some comments:</p><ol><li>As stated before, <code class="language-plaintext highlighter-rouge">CMAKE_CXX_COMPILER=icx</code> (the new Intel DPC++/C++ compiler) can lead to errors.<li>EXTRA_MOLECULE and EXTRA_PAIR packages are automatically removed during configuration. Edit ‘CMakeCache.txt’ afterwards to reopen them.<li>GPU-related options depend on architecture. See the <a href="https://docs.lammps.org/Build_extras.html#gpu-package">LAMMPS manual</a> for instructions.<li>When the single-precision FFTW3 lib is used (<code class="language-plaintext highlighter-rouge">FFT_SINGLE=YES</code>), the keywords of libs should be <code class="language-plaintext highlighter-rouge">FFTW3F_LIBRARY</code> and <code class="language-plaintext highlighter-rouge">FFTW3F_OMP_LIBRARY</code>. Otherwise, they are <code class="language-plaintext highlighter-rouge">FFTW3_LIBRARY</code> and <code class="language-plaintext highlighter-rouge">FFTW3_OMP_LIBRARY</code>. Static libs are strongly recommended for static linking.<li>The code can auto decide whether to launch threaded FFTW3 compilation according to <code class="language-plaintext highlighter-rouge">FFTW3_OMP_LIBRARY</code>. Using <code class="language-plaintext highlighter-rouge">FFT_FFTW_THREADS</code> is redundant and can lead to an error that the FFTW3 lib supporting OpenMP is not found (even though <code class="language-plaintext highlighter-rouge">FFTW3_OMP_LIBRARY</code> is specified).</ol><h2 id="dynamic-build">Dynamic build<a href="#dynamic-build" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>The following options enable a dynamic linking:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span>cmake ../cmake <span class="nt">--install-prefix</span> /path/to/lammps/23Jun2022/ <span class="nt">-D</span> <span class="nv">LAMMPS_MACHINE</span><span class="o">=</span>dym <span class="nt">-D</span> <span class="nv">CMAKE_CXX_COMPILER</span><span class="o">=</span>icpc <span class="nt">-D</span> <span class="nv">PKG_INTEL</span><span class="o">=</span>ON <span class="nt">-D</span> <span class="nv">INTEL_ARCH</span><span class="o">=</span>cpu <span class="nt">-D</span> <span class="nv">PKG_KSPACE</span><span class="o">=</span>ON <span class="nt">-D</span> <span class="nv">PKG_MOLECULE</span><span class="o">=</span>ON <span class="nt">-D</span> <span class="nv">PKG_EXTRA_MOLECULE</span><span class="o">=</span>ON <span class="nt">-D</span> <span class="nv">PKG_EXTRA_PAIR</span><span class="o">=</span>ON <span class="nt">-D</span> <span class="nv">PKG_PHONON</span><span class="o">=</span>ON <span class="nt">-D</span> <span class="nv">PKG_MANYBODY</span><span class="o">=</span>ON <span class="nt">-D</span> <span class="nv">BUILD_OMP</span><span class="o">=</span><span class="nb">yes</span> <span class="nt">-D</span> <span class="nv">PKG_OPENMP</span><span class="o">=</span>ON <span class="nt">-D</span> <span class="nv">CMAKE_CXX_FLAGS</span><span class="o">=</span><span class="nt">-fopenmp</span> <span class="nt">-D</span> <span class="nv">CMAKE_EXE_LINKER_FLAGS</span><span class="o">=</span><span class="nt">-fopenmp</span> <span class="nt">-D</span> <span class="nv">BUILD_SHARED_LIBS</span><span class="o">=</span>ON <span class="nt">-D</span> <span class="nv">LAMMPS_EXCEPTIONS</span><span class="o">=</span>ON <span class="nt">-D</span> <span class="nv">PKG_PYTHON</span><span class="o">=</span>ON <span class="nt">-D</span> <span class="nv">PKG_GPU</span><span class="o">=</span>ON <span class="nt">-D</span> <span class="nv">GPU_API</span><span class="o">=</span>cuda <span class="nt">-D</span> <span class="nv">GPU_PREC</span><span class="o">=</span>double <span class="nt">-D</span> <span class="nv">GPU_ARCH</span><span class="o">=</span>sm_60 <span class="nt">-D</span> <span class="nv">FFT</span><span class="o">=</span>FFTW3 <span class="nt">-D</span> <span class="nv">FFT_SINGLE</span><span class="o">=</span>YES <span class="nt">-D</span> <span class="nv">FFTW3F_LIBRARY</span><span class="o">=</span>/path/to/fftw/3.3.10/lib64/libfftw3f.so <span class="nt">-D</span> <span class="nv">FFTW3F_OMP_LIBRARY</span><span class="o">=</span>/path/to/fftw/3.3.10/lib64/libfftw3f_omp.so
<span class="gp">$</span><span class="w"> </span>cmake <span class="nt">--build</span> <span class="nb">.</span>
<span class="gp">$</span><span class="w"> </span>make <span class="nb">install</span>
</pre></table></code></div></div><p>Some comments:</p><ol><li>A dynamic build is launched by <code class="language-plaintext highlighter-rouge">BUILD_SHARED_LIBS=ON</code>.<li>The PYTHON package is included for integrating with python developing environment, see <a href="https://docs.lammps.org/Python_head.html">LAMMPS manual</a>.<li>The <code class="language-plaintext highlighter-rouge">LAMMPS_EXCEPTIONS=ON</code> option is to help keep and trace back the potential LAMMPS errors happened within python scripts.<li>Dynamic FFTW3 libs (‘libfftw3f.so’, ‘libfftw3f_omp.so’) are used in this example.</ol><h1 id="integration-with-python-developing-environment">Integration with Python developing environment</h1><h2 id="use-static-libs">Use static libs<a href="#use-static-libs" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>Loading the static builds for simulations and other packages for pre- and post- processing is a rather mature technique, which involves mainly python programming and a moderate amount of Linux command line. This can be achieved by already developed packages such as <a href="https://wiki.fysik.dtu.dk/ase/ase/calculators/lammps.html#module-ase.calculators.lammps">ASE LAMMPS calculators</a> and <a href="https://pyiron.readthedocs.io/en/latest/source/notebooks/first_steps.html#Perform-a-LAMMPS-MD-simulation">PyIron</a>.</p><h2 id="enable-a-object-oriented-programming">Enable a object-oriented programming<a href="#enable-a-object-oriented-programming" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>An purely object-oriented programming fashion is realized by loading the dynamic lib to Python developing environment, see <a href="https://docs.lammps.org/Python_head.html">LAMMPS manual</a>. The following paths should be specified:</p><ul><li>the dynamic lib file, in ‘/path/to/lammps/23Jun2022/lib64/liblammps_dym.so’<li>the LAMMPS python module, in ‘/path/to/lammps/23Jun2022/lib/site-packages/lammps’</ul><p>The default lib name for lammps object is ‘liblammps.so’. To correctly import and create the lammps object, the name can be specified by <code class="language-plaintext highlighter-rouge">lammps.lammps(name='dym')</code>, or use the following command:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span><span class="nb">ln</span> <span class="nt">-s</span> /path/to/lammps/23Jun2022/lib64/liblammps_dym.so /path/to/lammps/23Jun2022/lib64/liblammps.so
</pre></table></code></div></div><p>To correctly load the LAMMPS python module, the user can either merge the ‘lib/site-package’ folder with the default ‘site-package’ directory of the conda environment, or export the path to the environmental variable <code class="language-plaintext highlighter-rouge">$PYTHONPATH</code>. Alternatively, the path can be added on the top of python scripts, which is recommended:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">sys</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">sys</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="s">'/path/to/lammps/23Jun2022/lib/python3.X/site-packages'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">lammps</span>
</pre></table></code></div></div><p>The variable <code class="language-plaintext highlighter-rouge">${OMP_NUM_THREADS}</code> can be set if multi-threading is activated in compilation. The default vale is 1, i.e., no shared memory threading:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span><span class="nb">export </span><span class="nv">OMP_NUM_THREADS</span><span class="o">=</span>2
</pre></table></code></div></div><p>Launch the python environment, use the following commands:</p><div class="language-python highlighter-rouge"><div class="code-header"> <span label-text="Python"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">lammps</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">lmp</span><span class="o">=</span><span class="n">lammps</span><span class="p">.</span><span class="n">lammps</span><span class="p">()</span>
<span class="n">LAMMPS</span> <span class="p">(</span><span class="mi">23</span> <span class="n">Jun</span> <span class="mi">2022</span><span class="p">)</span>
  <span class="n">using</span> <span class="mi">2</span> <span class="n">OpenMP</span> <span class="n">thread</span><span class="p">(</span><span class="n">s</span><span class="p">)</span> <span class="n">per</span> <span class="n">MPI</span> <span class="n">task</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">exit</span><span class="p">()</span>
</pre></table></code></div></div><h2 id="a-collection-of-potential-problems">A collection of potential problems<a href="#a-collection-of-potential-problems" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>When loading the dynamic lib, it is probable that an error occurs: <strong>OSError: libpython3.10.so.1.0: cannot open shared object file: No such file or directory</strong>. Executable linked dynamically does not include the basic python libs, so the path to python libs should be added to <code class="language-plaintext highlighter-rouge">${LD_LIBRARY_PATH}</code>. Auto edition of environmental variables can be realized during activation / deactivation of anaconda environments. Use the following commands to set initialization options and then restart the python environment:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span><span class="nb">mkdir</span> <span class="nt">-p</span> <span class="k">${</span><span class="nv">CONDA_PREFIX</span><span class="k">}</span>/etc/conda/activate.d
<span class="gp">$</span><span class="w"> </span><span class="nb">touch</span> <span class="k">${</span><span class="nv">CONDA_PREFIX</span><span class="k">}</span>/etc/conda/activate.d/env_vars.sh
<span class="gp">$</span><span class="w"> </span><span class="nb">echo</span> <span class="s2">"export LD_LIBRARY_PATH=</span><span class="se">\"\$</span><span class="s2">{CONDA_PREFIX}/lib:</span><span class="se">\$</span><span class="s2">{LD_LIBRARY_PATH}</span><span class="se">\"</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> <span class="k">${</span><span class="nv">CONDA_PREFIX</span><span class="k">}</span>/etc/conda/activate.d/env_vars.sh
<span class="gp">$</span><span class="w"> </span><span class="nb">mkdir</span> <span class="nt">-p</span> <span class="k">${</span><span class="nv">CONDA_PREFIX</span><span class="k">}</span>/etc/conda/deactivate.d
<span class="gp">$</span><span class="w"> </span><span class="nb">touch</span> <span class="k">${</span><span class="nv">CONDA_PREFIX</span><span class="k">}</span>/etc/conda/deactivate.d/env_vars.sh
<span class="gp">$</span><span class="w"> </span><span class="nb">echo</span> <span class="s2">"LD_LIBRARY_PATH=</span><span class="se">\`</span><span class="s2">echo </span><span class="se">\$</span><span class="s2">{LD_LIBRARY_PATH//</span><span class="se">\"\$</span><span class="s2">{CONDA_PREFIX}/lib:</span><span class="se">\"</span><span class="s2">/''}</span><span class="se">\`</span><span class="s2">"</span> <span class="o">&gt;&gt;</span> <span class="k">${</span><span class="nv">CONDA_PREFIX</span><span class="k">}</span>/etc/conda/deactivate.d/env_vars.sh
</pre></table></code></div></div><p>By doing so, the <em>ncurses</em> lib from Anaconda seems to cover the default one, which leads to 2 problems. The first one is warnings such as ‘<strong>libtinfo.so.6: no version information available message using conda environment</strong>’, which is due to the releases of ncurses on the default Anaconda channel lack the version information. This can be solved by reinstalling it from the <code class="language-plaintext highlighter-rouge">conda-forge</code> channel:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span>conda <span class="nb">install</span> <span class="nt">-c</span> conda-forge ncurses
</pre></table></code></div></div><p>The second one is that it makes the <code class="language-plaintext highlighter-rouge">top</code> command, and probably more commands, invalid. But the <code class="language-plaintext highlighter-rouge">ps</code> command is effective. If the error occurs, finding an alternative or deactivating the current environment seem to be the only 2 solutions.</p><p>If the dumping option of video is activated, the path to the <em>ffmpeg</em> (for dumping videos) executable should be exported to <code class="language-plaintext highlighter-rouge">${PATH}</code>, while <em>libpng</em>, <em>zlib</em> and <em>libjpeg</em> remain accessible.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/technique/'>Technique</a>, <a href='/categories/parallel-computing/'>Parallel Computing</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/linux/" class="post-tag no-text-decoration" >linux</a> <a href="/tags/lammps/" class="post-tag no-text-decoration" >LAMMPS</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=LAMMPS compilation and integration with Python - Spica. Vir&url=https://spica-vir.github.io/posts/LAMMPS-compilation-and-integration-with-Python/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=LAMMPS compilation and integration with Python - Spica. Vir&u=https://spica-vir.github.io/posts/LAMMPS-compilation-and-integration-with-Python/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=LAMMPS compilation and integration with Python - Spica. Vir&url=https://spica-vir.github.io/posts/LAMMPS-compilation-and-integration-with-Python/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recent Update</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Structure-and-usage-of-clusters/">Structure and usage of clusters</a><li><a href="/posts/Compile-ONETEP-and-run-quality-tests/">Compile ONETEP and run quality tests</a><li><a href="/posts/Launch-Jupyter-Notebook-from-a-Remote-Server/">Set Up a Remote Jupyter Server</a><li><a href="/posts/LAMMPS-compilation-and-integration-with-Python/">LAMMPS compilation and integration with Python</a><li><a href="/posts/Optimized-Compilation-of-FFTW3/">Optimized compilation of FFTW3</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/regular-inspection/">regular inspection</a> <a class="post-tag" href="/tags/anaconda3/">Anaconda3</a> <a class="post-tag" href="/tags/crystal/">CRYSTAL</a> <a class="post-tag" href="/tags/imperial-rcs/">Imperial RCS</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/cluster/">cluster</a> <a class="post-tag" href="/tags/archer2/">ARCHER2</a> <a class="post-tag" href="/tags/sublime-text-4/">Sublime Text 4</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Structure-and-usage-of-clusters/"><div class="card-body"> <em class="timeago small" date="2022-04-06 16:59:03 +0100" >Apr 6, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Structure and usage of clusters</h3><div class="text-muted small"><p> This page is adapted from my Crystal Growth project notebook with added contents, which was written between Feb. and Mar. 2022 and shared within the group for induction and training proposes. Both ...</p></div></div></a></div><div class="card"> <a href="/posts/Compile-ONETEP-and-run-quality-tests/"><div class="card-body"> <em class="timeago small" date="2022-06-20 17:34:38 +0100" >Jun 20, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Compile ONETEP and run quality tests</h3><div class="text-muted small"><p> This post summarizes how to successfully compile ONETEP and run quality tests. The available version of ONETEP is v6.1.9, released on Jun. 2, 2022. Used compilers + fftw + libraries include: Fo...</p></div></div></a></div><div class="card"> <a href="/posts/Optimized-Compilation-of-FFTW3/"><div class="card-body"> <em class="timeago small" date="2022-12-30 16:26:05 +0000" >Dec 30, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Optimized compilation of FFTW3</h3><div class="text-muted small"><p> The optimized compilation of FFTW3 (version 3.3.10) is explored in this post. Even though some questions remains to be answered, it currently seems to be the optimal procedure. Tested on NHPC101 (O...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/How-to-use-Imperial-College-Research-Data-Store-(RDS)/" class="btn btn-outline-primary" prompt="Older"><p>How to use Imperial College Research Data Store (RDS)</p></a> <a href="/posts/Optimized-Compilation-of-FFTW3/" class="btn btn-outline-primary" prompt="Newer"><p>Optimized compilation of FFTW3</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://github.com/Spica-Vir">Spica.Vir</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/regular-inspection/">regular inspection</a> <a class="post-tag" href="/tags/anaconda3/">Anaconda3</a> <a class="post-tag" href="/tags/crystal/">CRYSTAL</a> <a class="post-tag" href="/tags/imperial-rcs/">Imperial RCS</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/cluster/">cluster</a> <a class="post-tag" href="/tags/archer2/">ARCHER2</a> <a class="post-tag" href="/tags/sublime-text-4/">Sublime Text 4</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
