<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="Compile VASP 5.4.1 on Ubuntu/Debain Linux" /><meta property="og:locale" content="en" /><meta name="description" content="This post is to briefly introduce available methods to compile VASP 5.4 on Ubuntu or Debain OSs. Tested on Debian WSL2, Windows 10 21H2, Jan. 9-21. VASP edition 5.4.1.05Feb16." /><meta property="og:description" content="This post is to briefly introduce available methods to compile VASP 5.4 on Ubuntu or Debain OSs. Tested on Debian WSL2, Windows 10 21H2, Jan. 9-21. VASP edition 5.4.1.05Feb16." /><link rel="canonical" href="https://spica-vir.github.io/posts/Compile-VASP-5.4-on-Ubuntu-Linux/" /><meta property="og:url" content="https://spica-vir.github.io/posts/Compile-VASP-5.4-on-Ubuntu-Linux/" /><meta property="og:site_name" content="Spica. Vir" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-01-18T17:07:32+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Compile VASP 5.4.1 on Ubuntu/Debain Linux" /><meta name="twitter:site" content="@twitter_username" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-04-20T21:53:38+01:00","datePublished":"2022-01-18T17:07:32+00:00","description":"This post is to briefly introduce available methods to compile VASP 5.4 on Ubuntu or Debain OSs. Tested on Debian WSL2, Windows 10 21H2, Jan. 9-21. VASP edition 5.4.1.05Feb16.","headline":"Compile VASP 5.4.1 on Ubuntu/Debain Linux","mainEntityOfPage":{"@type":"WebPage","@id":"https://spica-vir.github.io/posts/Compile-VASP-5.4-on-Ubuntu-Linux/"},"url":"https://spica-vir.github.io/posts/Compile-VASP-5.4-on-Ubuntu-Linux/"}</script><title>Compile VASP 5.4.1 on Ubuntu/Debain Linux | Spica. Vir</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Spica. Vir"><meta name="application-name" content="Spica. Vir"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="https://cdn.jsdelivr.net/gh/spica-vir/spica-vir.github.io/images//avatar.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Spica. Vir</a></div><div class="site-subtitle font-italic">Research, techniques and interests</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/Spica-Vir" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="" aria-label="" target="_blank" rel="noopener"> <i class=""></i> </a> <a href=" javascript:location.href = 'mailto:' + ['spica.h.zhou','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="" aria-label="" target="_blank" rel="noopener"> <i class=""></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Compile VASP 5.4.1 on Ubuntu/Debain Linux</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Compile VASP 5.4.1 on Ubuntu/Debain Linux</h1><div class="post-meta text-muted"><div> By <em> <a href="https://github.com/Spica-Vir">Spica.Vir</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" date="2022-01-18 17:07:32 +0000" data-toggle="tooltip" data-placement="bottom" title="Tue, Jan 18, 2022, 5:07 PM +0000" >Jan 18, 2022</em> </span> <span> Updated <em class="timeago" date="2024-04-20 21:53:38 +0100 " data-toggle="tooltip" data-placement="bottom" title="Sat, Apr 20, 2024, 9:53 PM +0100" >Apr 20</em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1185 words"> <em>6 min</em> read</span></div></div></div><div class="post-content"><p>This post is to briefly introduce available methods to compile VASP 5.4 on Ubuntu or Debain OSs. Tested on Debian WSL2, Windows 10 21H2, Jan. 9-21. VASP edition 5.4.1.05Feb16.</p><p>Currently there are two mainstream compiling and parallelizing solutions for VASP: by Intel parallel studio + Ifortran, or by openmpi + gfortran. The former one is an almost ‘all-in-one’ solution and easier to compile, but a valid license number is needed, which can be requested free of charge via educational/academic email addresses. The latter one is based on GNU license and free of charge, but more difficult - libraries of gfortran, openmpi, and ScaLAPACK are needed and package dependency should be carefully checked. According to many online tests, if parameters in the ‘makefile.include’ file (see below) are set properly, there is only a negligible difference in performances of VASP running on Intel package or GNU packages.</p><p>P.S. The author do not actually use VASP for research since July 2020, so the information provided here may not be up-to-date and well-maintained. Anyway, it is easy to get instructions from <a href="https://www.vasp.at/forum/viewforum.php?f=6">forums</a> and <a href="https://www.vasp.at/wiki/index.php/The_VASP_Manual#Getting_started">Wiki</a>.</p><h1 id="by-intel">By Intel</h1><p>References</p><ul><li><a href="http://bbs.keinsci.com/thread-14470-1-1.html">A text, step-by-step guide on Ubuntu</a>, in simplified Chinese.<li><a href="https://www.bilibili.com/video/av39616222/">A video guide on CentOS</a>, in Chinese.</ul><h2 id="a-recent-issue-with-intel-parallel-studio">A recent issue with Intel parallel studio<a href="#a-recent-issue-with-intel-parallel-studio" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>The latest available edition of Intel parallel studio is <a href="https://www.intel.com/content/www/us/en/developer/articles/release-notes/intel-parallel-studio-xe-2020-composer-edition-fortran-debug-solutions-release-notes.html">XE 2020</a>. Releases after that have been integrated into <a href="https://www.intel.com/content/www/us/en/developer/tools/oneapi/toolkits.html#gs.mcqdw6">oneAPI</a> and no new license number is released for the previous editions. Fortunately, oneAPI can be requested free of charge without a student license, and its usage is generally the same as the parallel studio. The environment used here is Parallel Studio XE 2020, which can still be obtained via ‘non-official’ sources.</p><h2 id="prerequisites">Prerequisites<a href="#prerequisites" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>For a newly installed WSL2 Debain subsystem, many packages are missing, Packages listed below should be installed via <code class="language-plaintext highlighter-rouge">sudo apt-get install</code> at least before installing Intel parallel studio:</p><ul><li><code class="language-plaintext highlighter-rouge">libgtk-3*</code><li><code class="language-plaintext highlighter-rouge">libxss1*</code><li><code class="language-plaintext highlighter-rouge">libnss3</code><li><code class="language-plaintext highlighter-rouge">libgtk2.*common</code><li><code class="language-plaintext highlighter-rouge">libpango-1*</code><li><code class="language-plaintext highlighter-rouge">libasound2*</code><li><code class="language-plaintext highlighter-rouge">xerver-xorg</code></ul><p>Besides, packages listed below should be installed at least before compiling VASP:</p><ul><li><code class="language-plaintext highlighter-rouge">rsync</code><li><code class="language-plaintext highlighter-rouge">gcc</code></ul><h2 id="install-intel-parallel-studio">Install Intel parallel studio<a href="#install-intel-parallel-studio" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ol><li>Unzip the package with the <code class="language-plaintext highlighter-rouge">tar -zxvf</code> command and enter the folder.<li>Type the command <code class="language-plaintext highlighter-rouge">./Install_GUI.sh</code> and enter the installing environment. Follow the instructions to complete the installation.<li>Set the environment variable for the Ifort compiler and the MKL library in <code class="language-plaintext highlighter-rouge">~/.bashrc</code>. Substitute <code class="language-plaintext highlighter-rouge">/your-intel-directory/</code> with the actual directory you place the folder.<div class="language-console highlighter-rouge"><div class="code-header"> <span label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span><span class="nb">echo</span> <span class="s2">"source /your-intel-directory/intel/bin/compilervars.sh intel64"</span> <span class="o">&gt;&gt;</span> ~/.bashrc
<span class="gp">$</span><span class="w"> </span><span class="nb">echo</span> <span class="s2">"source /your-intel-directory/intel/mkl/bin/mklvars.sh intel64"</span> <span class="o">&gt;&gt;</span> ~/.bashrc
<span class="gp">$</span><span class="w"> </span><span class="nb">source</span> ~/.bashrc
</pre></table></code></div></div><li>Check whether the compiler has been successfully installed and set up successfully with the commands <code class="language-plaintext highlighter-rouge">ifort -v</code>, <code class="language-plaintext highlighter-rouge">icc -v</code> and <code class="language-plaintext highlighter-rouge">echo $MKLROOT</code>.</ol><h2 id="compile-intel-fftw3-fast-fourier-transformation">Compile Intel fftw3 (Fast Fourier transformation)<a href="#compile-intel-fftw3-fast-fourier-transformation" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>Enter the folder <code class="language-plaintext highlighter-rouge">intel/mkl/interfaces/fftw3xf</code> and type the command <code class="language-plaintext highlighter-rouge">make libintel64</code> to compile Intel fftw3. The output is <code class="language-plaintext highlighter-rouge">libfftw3xf_intel.a</code>.</p><h2 id="patches">Patches<a href="#patches" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>See below: By GNU/Get patches</p><h2 id="compile-vasp">Compile VASP<a href="#compile-vasp" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ol><li>Unzip the VASP package and enter the folder.<li>Copy the file <code class="language-plaintext highlighter-rouge">arch/makefile.include.linux_intel</code> to the current directory, and rename it as <code class="language-plaintext highlighter-rouge">makefile.include</code>.<li>Open <code class="language-plaintext highlighter-rouge">makefile.include</code>, find the line with <code class="language-plaintext highlighter-rouge">OFLAG</code> and substitute it with the line below:<div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>OFLAG      = -O2 -xhost
</pre></table></code></div></div></ol><p>This command improves the performance of the compiled VASP.</p><ol><li>In the same directory, enter the command <code class="language-plaintext highlighter-rouge">make all</code> and wait.</ol><h2 id="usage">Usage<a href="#usage" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>The compiled program is at the <code class="language-plaintext highlighter-rouge">bin/</code> sub-folder. The most commonly used edition is <code class="language-plaintext highlighter-rouge">vasp_std</code>.</p><p>To launch VASP, firstly load Intel mpi and then execute <code class="language-plaintext highlighter-rouge">vasp_std</code> in parallel:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span><span class="nb">source</span> /your-intel-directory/intel/parallel_studio_xe_2020/psxevars.sh
<span class="gp">$</span><span class="w"> </span>mpirun <span class="nt">-np</span> <span class="o">[</span>number of processors] VASP/directory/bin/vasp_std <span class="o">&gt;</span> printout.log 
</pre></table></code></div></div><h2 id="a-known-issue-with-multi-node-parallelization">A known issue with multi-node parallelization<a href="#a-known-issue-with-multi-node-parallelization" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>An issue has been identified with Intel Parallel Studio XE 2020 when parallelizing multiple nodes. Discussions can be found in <a href="https://community.intel.com/t5/Intel-oneAPI-HPC-Toolkit/Issue-with-MPI-2019U6-and-MLX-provider/td-p/1167008">this page</a>. To address this problem, the following line, of which the exact meaning is unclear to me, should be inserted into the job submission script, or be entered in the command line, before the sentences executing parallel computations:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span><span class="nb">export </span><span class="nv">UCX_TLS</span><span class="o">=</span>ud,sm,self
</pre></table></code></div></div><h1 id="by-gnu">By GNU</h1><p>Compilation with GNU packages are more cumbersome because of the absence of a one-stop solution. Various packages and libraries are needed, and their dependencies and proper parameters should be checked carefully. The steps below were tested reliable in Jan. 2020 on a WSL1 Debain subsystem. However, error was reported when compiling the same source codes in Jan. 2022, saying that inconsistency in data type was detected for a certain variable. Not sure whether it originates from a library assumed to be unnecessary (libscalapack-openmpi1, see below). This section is listed here as a supplement.</p><p>Reference:</p><ul><li><a href="https://www5.hp-ez.com/hp/calculations/page377">A text guide</a> to compile VASP5.4.1 with GNU software, in Japanese.<li><a href="https://ishxiao.com/blog/ubuntu/2017/10/15/how-to-compile-install-vasp-5.4.1.html">Another text guide</a> in English.</ul><h2 id="prerequisites-1">Prerequisites<a href="#prerequisites-1" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>In practise the packages in both references are installed before VASP is successfully compiled. Therefore many packages are included (and some of them might be redundant):</p><p><strong>Compilers</strong></p><ul><li><code class="language-plaintext highlighter-rouge">csh</code><li><code class="language-plaintext highlighter-rouge">g++</code><li><code class="language-plaintext highlighter-rouge">gfortran</code><li><code class="language-plaintext highlighter-rouge">g++build-essential</code></ul><p><strong>MPI</strong></p><ul><li><code class="language-plaintext highlighter-rouge">libopenmpi-dev</code></ul><p><strong>Linear Algebra &amp; Parallelization</strong></p><ul><li><code class="language-plaintext highlighter-rouge">liblapack-dev</code><li><code class="language-plaintext highlighter-rouge">libblas-dev</code><li><code class="language-plaintext highlighter-rouge">libtmglib-dev</code><li><code class="language-plaintext highlighter-rouge">libatlas-base-dev</code><li><code class="language-plaintext highlighter-rouge">libscalapack-mpi-dev</code><li><code class="language-plaintext highlighter-rouge">libscalapack-openmpi1</code><li><code class="language-plaintext highlighter-rouge">libscalapack-openmpi-dev</code></ul><p><code class="language-plaintext highlighter-rouge">libscalapack-openmpi1</code> is an old-fashioned package and not available via <code class="language-plaintext highlighter-rouge">apt-get install</code>. An alternative is downloading it from <a href="https://packages.debian.org/stretch/libscalapack-openmpi1">the Debain webpage</a> manually checking its dependency. It depends on packages below:</p><ul><li><code class="language-plaintext highlighter-rouge">gcc-6-base</code><li><code class="language-plaintext highlighter-rouge">libgofortran3</code><li><code class="language-plaintext highlighter-rouge">libopenmpi2(old stable)</code><li><code class="language-plaintext highlighter-rouge">libblacs-openmpi1</code></ul><p>These packages are also recommended to be installed manually because of the version problem.</p><p><strong>Fast Fourier transformation</strong></p><ul><li><code class="language-plaintext highlighter-rouge">libfftw3-dev</code><li><code class="language-plaintext highlighter-rouge">libfftw3-3</code></ul><p><strong>Synchronizing data</strong></p><ul><li><code class="language-plaintext highlighter-rouge">rsync</code></ul><h2 id="get-patches">Get patches<a href="#get-patches" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>Unzip the VASP packages and enter the folder. Use the commands below to add patches to the source code:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span>wget http://cms.mpi.univie.ac.at/patches/patch.5.4.1.14032016.gz
<span class="gp">$</span><span class="w"> </span>wget http://cms.mpi.univie.ac.at/patches/patch.5.4.1.03082016.gz
<span class="gp">$</span><span class="w"> </span><span class="nb">gunzip </span>patch.5.4.1.14032016.gz
<span class="gp">$</span><span class="w"> </span><span class="nb">gunzip </span>patch.5.4.1.03082016.gz
<span class="gp">$</span><span class="w"> </span>patch <span class="nt">-p0</span> &lt; patch.5.4.1.14032016
<span class="gp">$</span><span class="w"> </span>patch <span class="nt">-p0</span> &lt; patch.5.4.1.03082016
</pre></table></code></div></div><dl><dt>Issue identified Jan. 9-21<dd>Unfortunately due to the abandon of the old website, both links are invalidate. The <a href="https://www.vasp.at/wiki/index.php/Installing_VASP.5.X.X#For_vasp.5.4.1.05Feb16_.28with_GPU_support.29">VASP Wiki</a> did not provide any updated resources for this issue, which influences all the patches for VASP5. Therefore, please check the descriptions of both patches and consider your propose of running VASP before continuing.</dl><h2 id="compile-vasp-1">Compile VASP<a href="#compile-vasp-1" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><ol><li>Copy the file <code class="language-plaintext highlighter-rouge">arch/makefile.include.linux_gfortran</code> to the current directory, and rename it as <code class="language-plaintext highlighter-rouge">makefile.include</code>.<li>Modify the file as follows. Check the directories in variables <code class="language-plaintext highlighter-rouge">LIBDIR</code>, <code class="language-plaintext highlighter-rouge">OBJECTS</code>, and <code class="language-plaintext highlighter-rouge">INCS</code>：</ol><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
</pre><td class="rouge-code"><pre># Precompiler options
CPP_OPTIONS= -DMPI -DHOST=\"IFC91_ompi\" -DIFC \
             -DCACHE_SIZE=4000 -Davoidalloc \
             -DMPI_BLOCK=8000 -DscaLAPACK -Duse_collective \
             -Duse_bse_te -Duse_shmem -Dtbdyn

CPP        = gcc -E -P -C $*$(FUFFIX) &gt;$*$(SUFFIX) $(CPP_OPTIONS)

FC         = mpif90.openmpi
FCL        = mpif90.openmpi

FREE       = -ffree-form -ffree-line-length-none

FFLAGS     = 
OFLAG      = -O2 -mtune=native -m64
OFLAG_IN   = $(OFLAG)
DEBUG      = -O0

LIBDIR     = /usr/lib/x86_64-linux-gnu
BLAS       = -L$(LIBDIR) -lblas
LAPACK     = -L$(LIBDIR) -ltmglib -llapack
BLACS      = -lblacs-openmpi -lblacsCinit-openmpi -lblacsF77init-openmpi
SCALAPACK  = -L$(LIBDIR) -lscalapack-openmpi $(BLACS)

OBJECTS    = fftmpiw.o fftmpi_map.o  fftw3d.o  fft3dlib.o \
             /usr/lib/x86_64-linux-gnu/libfftw3.a
INCS       =-I/usr/include -I/usr/lib/openmpi/include

LLIBS      = $(SCALAPACK) $(LAPACK) $(BLAS)

OBJECTS_O1 += fft3dfurth.o fftw3d.o fftmpi.o fftmpiw.o chi.o
OBJECTS_O2 += fft3dlib.o

# For what used to be vasp.5.lib
CPP_LIB    = $(CPP)
FC_LIB     = $(FC) 
CC_LIB     = gcc
CFLAGS_LIB = -O
FFLAGS_LIB = -O1
FREE_LIB   = $(FREE)

OBJECTS_LIB= linpack_double.o getshmem.o

# Normally no need to change this
SRCDIR     = ../../src
BINDIR     = ../../bin
</pre></table></code></div></div><ol><li><code class="language-plaintext highlighter-rouge">make all</code></ol><h2 id="usage-1">Usage<a href="#usage-1" class="anchor"><i class="fas fa-hashtag"></i></a></h2></h2><p>Similar to VASP compiled by Intel parallel studio, the command to launch parallel computation is:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="gp">$</span><span class="w"> </span>/usr/bin/mpirun.openmpi <span class="nt">-np</span> <span class="o">[</span>number of processors] VASP/directory/bin/vasp_std <span class="o">&gt;</span> printout.log
</pre></table></code></div></div></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/technique/'>Technique</a>, <a href='/categories/parallel-computing/'>Parallel Computing</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/vasp/" class="post-tag no-text-decoration" >VASP</a> <a href="/tags/linux/" class="post-tag no-text-decoration" >linux</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Compile VASP 5.4.1 on Ubuntu/Debain Linux - Spica. Vir&url=https://spica-vir.github.io/posts/Compile-VASP-5.4-on-Ubuntu-Linux/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Compile VASP 5.4.1 on Ubuntu/Debain Linux - Spica. Vir&u=https://spica-vir.github.io/posts/Compile-VASP-5.4-on-Ubuntu-Linux/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=Compile VASP 5.4.1 on Ubuntu/Debain Linux - Spica. Vir&url=https://spica-vir.github.io/posts/Compile-VASP-5.4-on-Ubuntu-Linux/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recent Update</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/Structure-and-usage-of-clusters/">Structure and usage of clusters</a><li><a href="/posts/Compile-ONETEP-and-run-quality-tests/">Compile ONETEP and run quality tests</a><li><a href="/posts/Launch-Jupyter-Notebook-from-a-Remote-Server/">Set Up a Remote Jupyter Server</a><li><a href="/posts/LAMMPS-compilation-and-integration-with-Python/">LAMMPS compilation and integration with Python</a><li><a href="/posts/Optimized-Compilation-of-FFTW3/">Optimized compilation of FFTW3</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/regular-inspection/">regular inspection</a> <a class="post-tag" href="/tags/anaconda3/">Anaconda3</a> <a class="post-tag" href="/tags/crystal/">CRYSTAL</a> <a class="post-tag" href="/tags/imperial-rcs/">Imperial RCS</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/cluster/">cluster</a> <a class="post-tag" href="/tags/archer2/">ARCHER2</a> <a class="post-tag" href="/tags/sublime-text-4/">Sublime Text 4</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/Structure-and-usage-of-clusters/"><div class="card-body"> <em class="timeago small" date="2022-04-06 16:59:03 +0100" >Apr 6, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Structure and usage of clusters</h3><div class="text-muted small"><p> This page is adapted from my Crystal Growth project notebook with added contents, which was written between Feb. and Mar. 2022 and shared within the group for induction and training proposes. Both ...</p></div></div></a></div><div class="card"> <a href="/posts/Compile-ONETEP-and-run-quality-tests/"><div class="card-body"> <em class="timeago small" date="2022-06-20 17:34:38 +0100" >Jun 20, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Compile ONETEP and run quality tests</h3><div class="text-muted small"><p> This post summarizes how to successfully compile ONETEP and run quality tests. The available version of ONETEP is v6.1.9, released on Jun. 2, 2022. Used compilers + fftw + libraries include: Fo...</p></div></div></a></div><div class="card"> <a href="/posts/LAMMPS-compilation-and-integration-with-Python/"><div class="card-body"> <em class="timeago small" date="2022-12-30 15:32:20 +0000" >Dec 30, 2022</em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>LAMMPS compilation and integration with Python</h3><div class="text-muted small"><p> Procedures to Compile LAMMPS as both static and dynamic libs are summarized in this post. When compiled as the dynamic lib, the integration of LAMMPS and python environment is briefly explored. The...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/CRYSTAL17-Resources/" class="btn btn-outline-primary" prompt="Older"><p>CRYSTAL Resources</p></a> <a href="/posts/VASP-resources/" class="btn btn-outline-primary" prompt="Newer"><p>VASP resources</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://github.com/Spica-Vir">Spica.Vir</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/linux/">linux</a> <a class="post-tag" href="/tags/windows/">windows</a> <a class="post-tag" href="/tags/regular-inspection/">regular inspection</a> <a class="post-tag" href="/tags/anaconda3/">Anaconda3</a> <a class="post-tag" href="/tags/crystal/">CRYSTAL</a> <a class="post-tag" href="/tags/imperial-rcs/">Imperial RCS</a> <a class="post-tag" href="/tags/python/">python</a> <a class="post-tag" href="/tags/cluster/">cluster</a> <a class="post-tag" href="/tags/archer2/">ARCHER2</a> <a class="post-tag" href="/tags/sublime-text-4/">Sublime Text 4</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
